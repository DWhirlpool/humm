import{p as e,l as t,a as n,k as o}from"./vendor.b3bd0ae2.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const o=new URL(e,location),i=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,r)=>{const s=new URL(e,o);if(self[t].moduleMap[s])return n(self[t].moduleMap[s]);const l=new Blob([`import * as m from '${s}';`,`${t}.moduleMap['${s}']=m;`],{type:"text/javascript"}),c=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(l),onerror(){r(new Error(`Failed to import: ${e}`)),i(c)},onload(){n(self[t].moduleMap[s]),i(c)}});document.head.appendChild(c)})),self[t].moduleMap={}}}("/assets/");const i={drawing:{scroll:0,scrollbar:{opacity:0}},scroll:0,rolloverScroll:0,cursors:[],buffer:null,ctx:null,moveContext:{},scrollbarContext:{}},r={editor:null,lines:null,decorations:null,textarea:null,scrollbar:null,scrollbarThumb:null,dumpButton:null},s=e({text:{color:"#e5e5e5",lineHeight:28,fontSize:16,font:"iA Writer Mono V, Menlo, monospace"},cursor:{width:4,color:"#838383",radius:2,animation:{duration:80}},scroll:{animation:{duration:80}},scrollbar:{width:8,gap:5,minHeight:32,color:"rgba(127, 127, 127, 0.5)",activeColor:"rgba(200, 200, 200, 0.5)",animation:{delay:800,duration:200}},selection:{color:"#444"},wrapping:{algorithm:"measure"}});var l=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",editor:i,elements:r,settings:s});let c,a;const u=new Map;function f(e){let t=u.get(e);return t||(t=c.measureText(e).width,u.set(e,t)),t}function h(e){if(!e)return 0;if(a)return e.length*a;let t=0;for(const n of e)t+=f(n);return t}const d=[];function m(e){if(!e)return d;const n=W()-10;if(h(e)<n)return d;const o=new t(e);let i,r=0,s=0;const l=[];for(;i=o.nextBreak();){const t=i.position,o=h(e.slice(r,t));s+=o,s>n&&(l.push(r),s=o),r=t}return l}!function(){c=document.createElement("canvas").getContext("2d",{alpha:!1,desynchronized:!0});const e=s.text.fontSize+"px "+s.text.font;c.font=e;const t=f("i");t===f("W")&&(a=t)}();class p{constructor(e=0,t=0){this.line=e,this.column=t}static from(e){return new p(e.line,e.column)}equals(e){return this.line===e.line&&this.column===e.column}before(e){return this.line<e.line||this.line===e.line&&this.column<e.column}after(e){return this.line>e.line||this.line===e.line&&this.column>e.column}}function g(e){const{buffer:t}=i,[n,o]=t.bufferToScreen(e.line,e.column),r=t.getScreenLineContent(n);return{x:0===o?0:h(r.slice(0,o)),y:n*s.text.lineHeight}}function b(e){if(null==e)return;const{cursors:t,buffer:n}=i;t.forEach((t=>{if(t.selection.isCollapsed){const{line:o,column:i}=t.position;n.swapLine(o,e)&&t.moveTo(o+e,i)}else{const{start:o,end:i}=t.selection;n.swapLines(o.line,i.line,e),t.moveSelection(new p(o.line+e,o.column),new p(i.line+e,i.column))}}))}function v(){const{cursors:e}=i,t=[];e.forEach((e=>{if(e.selection.isCollapsed)return;const n=function(e){const{buffer:t}=i,{start:n,end:o}=e;if(n.line===o.line){return t.getLineContent(n.line).slice(n.column,o.column)}{const e=[],i=t.getLineContent(n.line);e.push(i.slice(n.column));const r=n.line+1,s=o.line-1-r+1;for(let n=0;n<s;n++)e.push(t.getLineContent(n));const l=t.getLineContent(o.line);return e.push(l.slice(0,o.column)),e.join("\n")}}(e.selection);t.push(n)})),navigator.clipboard.writeText(t.join("\n")).catch((e=>{console.error("Failed to copy to clipboard!"),console.error(e)}))}function w(e){const{cursors:t,buffer:n}=i;t.forEach((t=>{t.deleteSelection();const{line:o,column:i}=t.position;n.insert(o,i,e),n.wrapLine(o),t.moveRight(e.length)}))}function L(e){if(0===e)return;const{buffer:t}=i;t.splitUp(e)}function y(){const{cursors:e}=i,t=[...e],n=[];let o=0;for(const i of e)n.some((e=>e.equals(i.position)))?t.splice(o,1):n.push(i.position),o++;i.cursors=t}function x(){i.cursors=[i.cursors[0]]}function T(){return i.cursors[0]}function S(){return i.buffer.screenLength}function E(){return i.scroll}function C(e){let t=e*s.text.lineHeight%5e5;return i.rolloverScroll>5e5&&(t-=5e5),t}function B(e){const t=i.scroll;if(e=Y(0,F(),e),i.scroll=e,e!==t){let e=i.scroll%5e5;e>5e5&&(e-=5e5),i.rolloverScroll=e,r.wrapper.style.top=-e+"px"}return e!==t}function k(e){let t=null;return window.addEventListener("resize",(()=>t=null)),()=>(t||(t=e()),t)}const P=k((()=>r.editor.offsetHeight)),W=k((()=>r.editor.offsetWidth)),M=k((()=>r.editor.offsetTop)),O=k((()=>r.editor.offsetLeft));function A(){return P()-2*s.scrollbar.gap}function K(){const e=A();return Y(s.scrollbar.minHeight,e,e/(1+F()/e))}function H(){return Math.max(0,Math.floor(E()/s.text.lineHeight))}function D(){const e=E()+P()-1;return Math.min(S()-1,Math.max(0,Math.floor(e/s.text.lineHeight)))}function $(e){const t=e+E()-M();return Math.max(0,Math.floor(t/s.text.lineHeight))}function _(e,t){const{buffer:n}=i,o=n.getScreenLineContent(t),r=e-O();let s=0;for(let i=0;i<=o.length;i++){if(s=i,h(o.slice(0,i))-h(o.slice(i-1,i))/2>r){s=i-1;break}}return Y(0,o.length,s)}function R(){const{buffer:e}=i;return e.length-1}function U(){const{buffer:e}=i;return e.screenLength-1}function I(){return new p(R(),function(){const{buffer:e}=i;return e.getLineContent(R())}().length)}function z(){return new p(U(),function(){const{buffer:e}=i;return e.getScreenLineContent(U())}().length)}function F(){const{height:e}={height:P(),width:W()},t=S()*s.text.lineHeight;return t>e?t-e:Math.min(t,e)-s.text.lineHeight}function Y(e,t,n){return Math.max(e,Math.min(n,t))}function q(e){return t=>{t.preventDefault(),null==e||e()}}const j=/\r\n|\r|\n/;class N{constructor(e=[],t){this.lines=e,this.breaks=[],this.getLineBreak=t,this.length=e.length,this.screenLength=e.length}wrap(){this.breaks=this.lines.map((e=>this.getLineBreak(e))),this.screenLength=this.breaks.reduce(((e,t)=>e+t.length+1),0)}wrapLine(e){const t=this.lines[e],n=this.breaks[e].length+1;this.breaks[e]=this.getLineBreak(t),this.screenLength+=this.breaks[e].length+1-n}append(e){this.lines.push(e);const t=this.getLineBreak(e);this.breaks.push(t),this.length++,this.screenLength+=t.length+1}insert(e,t){const n=this.getLineBreak(t);this.lines.splice(e,0,t),this.breaks.splice(e,0,n),this.length++,this.screenLength+=n.length+1}remove(e){const[t]=this.lines.splice(e,1),[n]=this.breaks.splice(e,1);return this.length--,this.screenLength-=n.length+1,t}}class X{constructor(e){this.lineBuffers=[],this.length=0,this.screenLength=0,this.getLineBreak=e,this.file=null,this.lineLimit=5e3}wrapLine(e){const[t,n]=this.getLineInfo(e);t.wrapLine(n),this.recalculateScreenLength()}wrapScreenLine(e){const{bufferLineNumber:t}=this.getScreenLineInfo(e);return this.wrapLine(t)}wrapAllLineBuffers(e=0){return this.screenLength=this.length,new Promise((t=>{const n=e=>{if(e>=this.lineBuffers.length)return t();this.wrapLineBuffer(e),requestAnimationFrame((()=>n(e+1)))};requestAnimationFrame((()=>n(e)))}))}wrapAllLineBuffersSync(e=0){this.screenLength=this.length;for(let t=e;t<this.lineBuffers.length;t++)this.wrapLineBuffer(t)}wrapLineBuffer(e){var t;null==(t=this.lineBuffers[e])||t.wrap(),this.recalculateScreenLength()}recalculateScreenLength(){this.screenLength=this.lineBuffers.reduce(((e,t)=>e+t.screenLength),0)}static async loadBrowserFile(e,t){const n=new X(t);n.getLineBreak=t;const o=e.stream().getReader(),i=new TextDecoder;return new Promise((e=>{o.read().then((function t({done:r,value:s}){if(r)return e(n);const l=i.decode(s);return n.loadText(l),o.read().then(t)}))}))}loadText(e){const t=e.split(j);for(let n=0;n<t.length;n+=this.lineLimit){const e=new N(t.slice(n,n+this.lineLimit),this.getLineBreak);this.lineBuffers.push(e),this.length+=e.length,this.screenLength+=e.screenLength}}getLineContent(e){const[t,n]=this.getLineInfo(e);return null==t?void 0:t.lines[n]}screenToBuffer(e,t){const{startColumn:n,bufferLineNumber:o}=this.getScreenLineInfo(e);return[o,n+t]}bufferToScreen(e,t){e=Y(0,this.length-1,e);const[n,o,i]=this.getLineInfo(e),r=n.breaks[o]||[];let s=this.lineBuffers.slice(0,i).reduce(((e,t)=>e+t.screenLength),0),l=0;for(let a=0;a<o;a++)s+=n.breaks[a].length+1;let c=0;for(let a=0;a<r.length&&!(r[a]>t);a++)c++;s+=c;return l=t-(r[c-1]||0),[s,l]}getScreenLineContent(e){const{bufferLine:t,startColumn:n,endColumn:o}=this.getScreenLineInfo(e);return t?t.slice(n,o):""}getScreenLineInfo(e){let t=0,n=0;for(const o of this.lineBuffers){const{lines:i,breaks:r}=o,s=n+o.length,l=t+o.screenLength;if(e<l){const o=e-t;let s=0,l=0;for(const e of r){if(s+e.length>=o){const t=o-s;return{bufferLine:i[l],bufferLineNumber:l+n,startColumn:e[t-1]||0,endColumn:e[t]}}l++,s+=e.length+1}}t=l,n=s}return console.warn("Did not find screen line!",e),{}}getLineInfo(e){let t=0,n=0;for(const o of this.lineBuffers){if(t+o.lines.length-1>=e)return[o,e-t,n];t+=o.length,n++}return console.warn("Did not find buffer line!",e),[]}insert(e,t,n){const[o,i]=this.getLineInfo(e),r=o.lines[i];if(t>=r.length)o.lines[i]+=n;else{const e=r.slice(0,t)+n+r.slice(t);o.lines[i]=e}o.wrapLine(i),this.recalculateScreenLength()}append(e,t){this.insert(e,1/0,t)}appendLine(e){const t=(n=this.lineBuffers)[n.length-1];var n;return t.append(e),this.length++,this.recalculateScreenLength(),[t,t.lines.length]}insertLine(e,t=""){if(e>this.length-1)return this.appendLine(t);e=Math.max(e,0);const[n,o]=this.getLineInfo(e);return n.insert(o,t),this.length++,this.recalculateScreenLength(),[n,o+1]}removeLine(e){const[t,n]=this.getLineInfo(e),o=t.remove(n);return this.length--,this.recalculateScreenLength(),o}swapLines(e,t,n){if(n<0)for(let o=e;o<=t;o++)this.swapLine(o,n);else for(let o=t;o>=e;o--)this.swapLine(o,n)}swapLine(e,t){if(0===e&&t<0)return;if(e===this.length-1&&t>0)return;const n=e+t,o=this.removeLine(e);return this.insertLine(n,o),!0}delete(e,t,n){if(0===n)return;if(n>0)return this.delete(e,t+n,-n);const[o,i]=this.getLineInfo(e),r=o.lines[i],s=r.slice(0,t+n)+r.slice(t);o.lines[i]=s}splitDown(e,t){const[n,o]=this.getLineInfo(e),i=n.lines[o],r=i.slice(0,t),s=i.slice(t);n.lines[o]=r,this.insertLine(e+1,s)}splitUp(e){if(0===e)return;const t=this.removeLine(e);this.append(e-1,t)}toString(){let e="";for(const t of this.lineBuffers)for(const n of t)e+=n,e+="\n";return e}}class V{constructor(e={}){this._focus=e.point||new p,this._anchor=e.point||new p,this.start=e.point||new p,this.end=e.point||new p,this.isCollapsed=!0,this.direction=G(this._focus,this._anchor)}get focus(){return this._focus}get anchor(){return this._anchor}set focus(e){this._focus=e,this.derive()}set anchor(e){this._anchor=e,this.derive()}derive(){this.direction=G(this.focus,this.anchor),this.isCollapsed=this.focus.equals(this.anchor),this.start="forward"===this.direction?this.anchor:this.focus,this.end="forward"===this.direction?this.focus:this.anchor}}function G(e,t){return e.before(t)?"backward":"forward"}function J({text:e,direction:t,amount:n,column:o}){const{textarea:i}=r;i.value=e,i.setSelectionRange(o,o,"forward");const s=window.getSelection();i.focus(),s.modify("move",t,n);const l=i.selectionStart;return i.value="",l}class Q{constructor(e={}){this.id=Math.random().toString(16).slice(2),this.selection=new V(e),this.drawing=g(this.selection.focus)}get position(){return this.selection.focus}deleteSelection(){const{buffer:e}=i,{start:t,end:n}=this.selection;if(t.line===n.line)e.delete(t.line,t.column,n.column-t.column),e.wrapLine(t.line);else{const o=e.getScreenLineContent(t.line).length;e.delete(t.line,o,t.column-o),e.wrapLine(t.line);const i=t.line+1,r=n.line-1-i+1;for(let t=0;t<r;t++)e.removeLine(i);const s=n.line-r;e.delete(s,0,n.column),e.splitUp(s)}this.moveToPoint(t)}moveSelection(e,t){this.moveTo(e.line,e.column,!1,!1),this.moveTo(t.line,t.column,!0,!0)}moveToPoint(e,...t){this.moveTo(e.line,e.column,...t)}moveTo(e,t,n=!1){let o;o=e instanceof p?p.from(e):new p(e,t),this.drawing=g(o),this.selection.focus=o,n||(this.selection.anchor=o)}moveWithSelect(e,t){return this.moveTo(e.line,e.column,t)}moveUp(e=1,t){const{buffer:n}=i;let o=p.from(this.position);if(0===this.position.line)o=new p(0,0);else{const[t,i]=n.bufferToScreen(this.position.line,this.position.column),r=Math.max(0,t-e),s=Math.min(i,n.getScreenLineContent(r).length),[l,c]=n.screenToBuffer(r,s);o.line=l,o.column=c}this.moveWithSelect(o,t)}moveDown(e=1,t){const{buffer:n}=i;let o=p.from(this.position);if(this.position.line===R())o=I();else{const[t,i]=n.bufferToScreen(this.position.line,this.position.column),r=Math.min(U(),t+e),s=Math.min(i,n.getScreenLineContent(r).length),[l,c]=n.screenToBuffer(r,s);o.line=l,o.column=c}this.moveWithSelect(o,t)}moveRight(e=1,t){if(!this.selection.isCollapsed&&!t)return this.moveToPoint(this.selection.end);if(this.position.equals(I()))return this.moveWithSelect(I(),t);const{buffer:n}=i,o=this.position.column+e,r=n.getLineContent(this.position.line),s=p.from(this.position);o>=r.length+1?(s.line++,s.column=e-1):s.column+=e,this.moveWithSelect(s,t)}moveLeft(e=1,t){if(!this.selection.isCollapsed&&!t)return this.moveToPoint(this.selection.start);if(this.position.column<=0&&this.position.line<=0)return;const{buffer:n}=i,o=p.from(this.position);0===this.position.column?(o.line--,o.column=n.getLineContent(o.line).length-e+1):o.column-=e,this.moveWithSelect(o,t)}moveToTop(e){const t=new p(0,0);this.moveWithSelect(t,e)}moveToBottom(e){const t=I();this.moveWithSelect(t,e)}moveToStartOfLine(e){const{buffer:t}=i,[n]=t.bufferToScreen(this.position.line,this.position.column),[o,r]=t.screenToBuffer(n,0),s=new p(o,r);this.moveWithSelect(s,e)}moveToEndOfLine(e){const{buffer:t}=i,[n]=t.bufferToScreen(this.position.line,this.position.column),o=t.getScreenLineContent(n).length,[r,s]=t.screenToBuffer(n,o),l=new p(r,s);this.moveWithSelect(l,e)}startOfNextLine(){this.moveTo(this.position.line+1,0)}moveToStartOfWord(e){const{buffer:t}=i,n=t.getLineContent(this.position.line),o=t.getLineContent(this.position.line-1),r=p.from(this.position);if(0!==this.position.line){const e=J({text:`${o}\n${n}`,direction:"backward",amount:"word",column:this.position.column+o.length});e<=o.length?(r.column=e,r.line--):r.column=e-o.length-1}else{const e=J({text:n,direction:"backward",amount:"word",column:this.position.column});r.column=e}this.moveWithSelect(r,e)}moveToEndOfWord(e){if(this.position.equals(I()))return void this.moveWithSelect(I(),e);const{buffer:t}=i,n=t.getLineContent(this.position.line),o=t.getLineContent(this.position.line+1),r=p.from(this.position);if(null!=o){const e=J({text:`${n}\n${o}`,direction:"forward",amount:"word",column:this.position.column});e>n.length?(r.column=e-n.length-1,r.line++):r.column=e}else{const e=J({text:n,direction:"forward",amount:"word",column:this.position.column});r.column=e}this.moveWithSelect(r,e)}moveToStartOfParagraph(e){this.moveWithSelect(new p(this.position.line,0),e)}moveToEndOfParagraph(e){const{buffer:t}=i,n=t.getLineContent(this.position.line).length,o=new p(this.position.line,n);this.moveWithSelect(o,e)}selectWord(){this.moveToStartOfWord(!1),this.moveToEndOfWord(!0)}selectParagraph(){this.moveToStartOfParagraph(!1),this.moveToEndOfParagraph(!0)}}let Z,ee=new Map,te=new Map;function ne(e){!function(e=!0){const t=H(),n=D(),o=Math.max(P(),i.buffer.screenLength*s.text.lineHeight);if(r.lines.style.height=o+"px",!ee.size){for(let e=t;e<=n;e++){const t=ce(e);r.lines.appendChild(t),ee.set(e,t)}return}for(let s=t;s<=n;s++){if(ee.has(s)){if(e){const e=ee.get(s);e.style.top=C(s)+"px",e.innerText=i.buffer.getScreenLineContent(s)}continue}const t=ce(s);r.lines.appendChild(t),ee.set(s,t)}for(let[i,r]of ee.entries())(i<t||i>n)&&(ee.delete(i),r.remove())}(e),re(),function(){const{textarea:e}=r;se(T(),e)}(),oe()}function oe(){const e=E()/F();r.scrollbarThumb.style.height=K()+"px",r.scrollbarThumb.style.transform=`translateY(${e*(A()-K())}px)`}function ie(){const{textarea:e}=r,t=T();return setTimeout((()=>{e.focus()}),1),function(e){const t=E();if(e<=t)return B(e);const n=P();return e+s.text.lineHeight>t+n&&B(e+s.text.lineHeight-n)}(t.drawing.y)}function re(){te.size||i.cursors.map((e=>{const t=function(){const e=document.createElement("div");return e.setAttribute("writer-cursor",""),e}();r.wrapper.appendChild(t),te.set(e.id,t)})),i.cursors.map((e=>{se(e,te.get(e.id))}))}function se(e,t){t.style.transform=`translate(${e.drawing.x}px, ${e.drawing.y}px)`}function le(){const e=document.createElement("div");return e.setAttribute("writer-editor",""),function(e){const t=(null==e?void 0:e.style)||r.editor.style;t.setProperty("--text-line-height",s.text.lineHeight+"px"),t.setProperty("--text-color",s.text.color),t.setProperty("--text-font-family",s.text.font),t.setProperty("--selection-color",s.selection.color),t.setProperty("--cursor-width",s.cursor.width+"px"),t.setProperty("--cursor-radius",s.cursor.radius+"px"),t.setProperty("--cursor-color",s.cursor.color),t.setProperty("--cursor-animation-duration",s.cursor.animation.duration+"ms"),t.setProperty("--scrollbar-width",s.scrollbar.width+"px"),t.setProperty("--scrollbar-gap",s.scrollbar.gap+"px"),t.setProperty("--scrollbar-color",s.scrollbar.color),t.setProperty("--scrollbar-active-color",s.scrollbar.activeColor),t.setProperty("--scrollbar-minHeight",s.scrollbar.minHeight+"px"),t.setProperty("--scrollbar-animation-duration",s.scrollbar.animation.duration+"ms")}(e),e}function ce(e){const t=document.createElement("div");return t.setAttribute("writer-line",""),t.style.top=C(e)+"px",t.innerText=i.buffer.getScreenLineContent(e),t}function ae(){const e=r.editor.parentElement.offsetHeight,t=W();r.editor.style.height=e+"px",r.lines.style.width=t+"px",void 0!==Z&&Z!==t&&(!function(){const e=H(),t=D();for(let n=e;n<=t;n++)i.buffer.wrapScreenLine(n)}(),ue()),ne(!0),Z=t}const ue=n((()=>{i.buffer.wrapAllLineBuffers()}),400);let fe;function he(){clearTimeout(fe),r.scrollbarThumb.style.opacity="1"}function de(){clearTimeout(fe),fe=setTimeout((()=>{r.scrollbarThumb.style.opacity="0"}),s.scrollbar.animation.delay)}function me(e){B(i.scroll+e.deltaY)&&(ne(),he(),de())}function pe(e){e.preventDefault();w(e.clipboardData.getData("text/plain")),ie(),ne()}function ge(e){const t=e.target.value;e.target.value="",w(t),ie(),ne()}function be(e){let t=!0;switch(e.key){case"Enter":!function(){const{cursors:e,buffer:t}=i;e.forEach((e=>{const{line:n,column:o}=e.position;t.splitDown(n,o),e.startOfNextLine()}))}();break;case"Backspace":e.metaKey?function(){const{cursors:e,buffer:t}=i;e.forEach((e=>{const{line:n,column:o}=e.position;0===o?(e.moveLeft(),L(n)):(t.delete(n,o,-o),t.wrapLine(n),e.moveToStartOfLine())}))}():e.altKey?function(){const{cursors:e}=i;e.forEach((e=>{if(!e.selection.isCollapsed)return void e.deleteSelection();const{line:t,column:n}=e.position;if(0===n)e.moveLeft(),L(t);else{const t=e.selection.focus;e.moveToStartOfWord(),e.moveWithSelect(t,!0),e.deleteSelection()}}))}():function(){const{cursors:e,buffer:t}=i;e.forEach((e=>{const{line:n,column:o}=e.position;e.selection.isCollapsed?0===o?(e.moveLeft(),L(n)):(t.delete(n,o,-1),t.wrapLine(n),e.moveLeft()):e.deleteSelection()}))}();break;case"ArrowUp":e.metaKey?function(e){x();const{cursors:t}=i;t[0].moveToTop(e)}(e.shiftKey):e.altKey&&!e.shiftKey?b(-1):function(e,t){const{cursors:n}=i;n.forEach((n=>{n.moveUp(e,t)})),y()}(1,e.shiftKey);break;case"ArrowDown":e.metaKey?function(e){x();const{cursors:t}=i;t[0].moveToBottom(e)}(e.shiftKey):e.altKey&&!e.shiftKey?b(1):function(e,t){const{cursors:n}=i;n.forEach((n=>{n.moveDown(e,t)})),y()}(1,e.shiftKey);break;case"ArrowRight":e.metaKey?function(e){const{cursors:t}=i;t.forEach((t=>{t.moveToEndOfLine(e)}))}(e.shiftKey):e.altKey?function(e){const{cursors:t}=i;t.forEach((t=>{t.moveToEndOfWord(e)}))}(e.shiftKey):function(e=1,t){const{cursors:n}=i;n.forEach((n=>{n.moveRight(e,t)})),y()}(1,e.shiftKey);break;case"ArrowLeft":e.metaKey?function(e){const{cursors:t}=i;t.forEach((t=>{t.moveToStartOfLine(e)}))}(e.shiftKey):e.altKey?function(e){const{cursors:t}=i;t.forEach((t=>{t.moveToStartOfWord(e)}))}(e.shiftKey):function(e=1,t){const{cursors:n}=i;n.forEach((n=>{n.moveLeft(e,t)})),y()}(1,e.shiftKey);break;case"a":e.metaKey?function(){x();const{cursors:e}=i;e[0].moveToTop(),e[0].moveToBottom(!0)}():t=!1;break;case"c":e.metaKey?v():t=!1;break;case"x":e.metaKey?function(){const{cursors:e}=i;v(),e.forEach((e=>{e.deleteSelection()}))}():t=!1;break;default:t=!1}t&&(e.preventDefault(),ie(),ne())}function ve(e){const t=F()/(A()-K()),n=e.pageY-i.scrollbarContext.initialY,o=E()+t*n;i.scrollbarContext.initialY=e.pageY,B(o),ne()}function we(){window.removeEventListener("mousemove",ve),window.removeEventListener("mouseup",this),i.scrollbarContext={},de()}function Le(e){e.preventDefault(),i.scrollbarContext.initialY=e.pageY,r.scrollbarThumb.style.opacity="1",window.addEventListener("mousemove",ve),window.addEventListener("mouseup",we)}function ye(){"0"!==r.scrollbarThumb.style.opacity&&he()}function xe(){i.scrollbarContext.initialY||de()}function Te(e){const{cursors:t,moveContext:n,buffer:o}=i;let{pageX:r,pageY:s}=e;const l=$(s),c=l>U()?z():new p(l,_(r,l)),[a,u]=o.screenToBuffer(c.line,c.column),f=new p(a,u),h=t[0];h.selection.focus.equals(f)||(2===(null==n?void 0:n.detail)?(h.selection.focus=f,"backward"===h.selection.direction?((null==n?void 0:n.reversed)||(h.moveToEndOfWord(),n.reversed=!0),h.moveToStartOfWord(!0)):h.moveToEndOfWord(!0)):3===n.detail?(h.selection.focus=f,"backward"===h.selection.direction?((null==n?void 0:n.reversed)||(h.moveToEndOfParagraph(),n.reversed=!0),h.moveToStartOfParagraph(!0)):h.moveToEndOfParagraph(!0)):h.moveTo(f.line,f.column,!0)),ie(),re()}function Se(){window.removeEventListener("mousemove",Te),window.removeEventListener("mouseup",this),i.moveContext={}}function Ee(e){const{cursors:t,moveContext:n,buffer:o}=i;let{pageX:r,pageY:s}=e;const l=$(s),c=l>U()?z():new p(l,_(r,l)),[a,u]=o.screenToBuffer(c.line,c.column),f=new p(a,u);if(e.altKey){const e=new Q;e.moveToPoint(f),t.push(e)}else x(),e.shiftKey?t[0].moveToPoint(f,!0):t[0].moveToPoint(f),n.detail=e.detail,2===e.detail?t[0].selectWord():3===e.detail&&t[0].selectParagraph();window.addEventListener("mousemove",Te),window.addEventListener("mouseup",Se),ie(),ne()}function Ce(e){e.stopPropagation(),e.preventDefault(),document.body.style.border="2px solid red"}function Be(e){e.stopPropagation(),e.preventDefault()}function ke(e){e.stopPropagation(),e.preventDefault(),document.body.style.border=null}async function Pe(e){e.stopPropagation(),e.preventDefault(),document.body.style.border=null;const t=e.dataTransfer.files[0];if(!t)return;console.time("FULL load file"),console.time("Resetting editor"),r.lines.innerHTML="",Array.from(te).forEach((([,e])=>e.remove())),ee=new Map,te=new Map,B(0),i.cursors=[new Q],console.timeEnd("Resetting editor"),console.time("Load file into Buffer");const n=await X.loadBrowserFile(t,m);console.timeEnd("Load file into Buffer"),console.time("Wrap all line buffers (sync)"),n.wrapAllLineBuffersSync(),console.timeEnd("Wrap all line buffers (sync)"),oe(),i.buffer=n,console.time("First draw"),ne(),console.timeEnd("First draw"),console.timeEnd("FULL load file")}function We(){console.log(i),console.log(void 0)}!async function(e){const{elements:t,editor:n}=l;t.editor=le(),t.textarea=function(){const e=document.createElement("textarea");return e.setAttribute("writer-textarea",""),e.setAttribute("autocomplete","off"),e.setAttribute("autocapitalize","off"),e.setAttribute("autocorrect","off"),e.setAttribute("spellcheck","false"),e.setAttribute("tab-index","0"),e}(),t.lines=function(){const e=document.createElement("div");return e.setAttribute("writer-lines",""),e}(),t.decorations=function(){const e=document.createElement("div");return e.setAttribute("writer-decorations",""),e}(),t.wrapper=function(){const e=document.createElement("div");return e.setAttribute("writer-wrapper",""),e}();const[i,r]=function(){const e=document.createElement("div");e.setAttribute("writer-scrollbar","");const t=document.createElement("div");return t.setAttribute("writer-scrollbar-thumb",""),e.appendChild(t),[e,t]}();t.scrollbar=i,t.scrollbarThumb=r,t.wrapper.appendChild(t.textarea),t.wrapper.appendChild(t.decorations),t.wrapper.appendChild(t.lines),t.editor.appendChild(t.wrapper),t.editor.appendChild(t.scrollbar),e.appendChild(t.editor),window.addEventListener("resize",ae),document.body.addEventListener("dragenter",Ce),document.body.addEventListener("dragover",Be),document.body.addEventListener("dragleave",ke),document.body.addEventListener("drop",Pe),t.editor.addEventListener("mousedown",(()=>setTimeout((()=>t.textarea.focus()),1))),t.editor.addEventListener("wheel",me),t.lines.addEventListener("mousedown",Ee),t.textarea.addEventListener("input",ge),t.textarea.addEventListener("paste",pe),t.textarea.addEventListener("keydown",be),t.scrollbarThumb.addEventListener("mousedown",Le),t.scrollbar.addEventListener("mouseenter",ye),t.scrollbar.addEventListener("mouseleave",xe);const c=new X(m);console.time("Load text into buffer"),c.loadText("Hey, welcome to humm.\n"),console.timeEnd("Load text into buffer"),console.time("Wrap all line buffers (sync)"),c.wrapAllLineBuffersSync(),console.timeEnd("Wrap all line buffers (sync)"),n.buffer=c,n.cursors=[new Q],t.lines.style.height=c.screenLength*s.text.lineHeight+"px",console.time("Draw first screen"),ae(),console.timeEnd("Draw first screen"),o(window,{"$mod+z":q((()=>n.buffer.undo())),"$mod+Shift+z":q((()=>n.buffer.redo())),"$mod+d":q(We),"$mod+s":q(),"$mod+p":q((()=>ne()))})}(document.querySelector("main"));
